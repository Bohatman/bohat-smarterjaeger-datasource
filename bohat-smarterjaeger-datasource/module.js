/* [create-plugin] version: 5.19.2 */
define(["rxjs","module","@grafana/ui","react","@grafana/data","@grafana/runtime"],((e,t,r,n,o,a)=>(()=>{var i={41:e=>{e.exports=function(e){return function(t){return e(t)}}},492:(e,t,r)=>{e=r.nmd(e);var n=r(1433),o=r(659),a=t&&!t.nodeType&&t,i=a&&e&&!e.nodeType&&e,u=i&&i.exports===a?n.Buffer:void 0,l=(u?u.isBuffer:void 0)||o;e.exports=l},659:e=>{e.exports=function(){return!1}},1163:(e,t,r)=>{var n=r(6204),o=r(1256),a=r(6397),i=r(492),u=r(2845),l=r(7995),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=a(e),s=!r&&o(e),p=!r&&!s&&i(e),f=!r&&!s&&!p&&l(e),v=r||s||p||f,y=v?n(e.length,String):[],b=y.length;for(var d in e)!t&&!c.call(e,d)||v&&("length"==d||p&&("offset"==d||"parent"==d)||f&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||u(d,b))||y.push(d);return y}},1256:(e,t,r)=>{var n=r(9250),o=r(2934),a=Object.prototype,i=a.hasOwnProperty,u=a.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(e){return o(e)&&i.call(e,"callee")&&!u.call(e,"callee")};e.exports=l},1269:t=>{"use strict";t.exports=e},1308:e=>{"use strict";e.exports=t},1433:(e,t,r)=>{var n=r(5380),o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")();e.exports=a},1485:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},1491:(e,t,r)=>{var n=r(8953),o=r(7499),a=r(8201),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return a(e);var t=o(e),r=[];for(var u in e)("constructor"!=u||!t&&i.call(e,u))&&r.push(u);return r}},1506:(e,t,r)=>{var n=r(4796),o=r(5265),a=r(6805);e.exports=function(e,t){return a(o(e,t,n),e+"")}},1738:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},2007:e=>{"use strict";e.exports=r},2781:(e,t,r)=>{var n=r(1433).Symbol;e.exports=n},2845:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},2934:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},3122:e=>{e.exports=function(e){return function(){return e}}},3330:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},3685:(e,t,r)=>{e=r.nmd(e);var n=r(5380),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,i=a&&a.exports===o&&n.process,u=function(){try{var e=a&&a.require&&a.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=u},3936:(e,t,r)=>{var n=r(1506),o=r(9316),a=r(6220),i=r(5405),u=Object.prototype,l=u.hasOwnProperty,c=n((function(e,t){e=Object(e);var r=-1,n=t.length,c=n>2?t[2]:void 0;for(c&&a(t[0],t[1],c)&&(n=1);++r<n;)for(var s=t[r],p=i(s),f=-1,v=p.length;++f<v;){var y=p[f],b=e[y];(void 0===b||o(b,u[y])&&!l.call(e,y))&&(e[y]=s[y])}return e}));e.exports=c},3983:e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),a=16-(o-n);if(n=o,a>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},4796:e=>{e.exports=function(e){return e}},5265:(e,t,r)=>{var n=r(6701),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var a=arguments,i=-1,u=o(a.length-t,0),l=Array(u);++i<u;)l[i]=a[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=a[i];return c[t]=r(l),n(e,this,c)}}},5380:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},5405:(e,t,r)=>{var n=r(1163),o=r(1491),a=r(8330);e.exports=function(e){return a(e)?n(e,!0):o(e)}},5959:e=>{"use strict";e.exports=n},6204:e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},6220:(e,t,r)=>{var n=r(9316),o=r(8330),a=r(2845),i=r(8953);e.exports=function(e,t,r){if(!i(r))return!1;var u=typeof t;return!!("number"==u?o(r)&&a(t,r.length):"string"==u&&t in r)&&n(r[t],e)}},6397:e=>{var t=Array.isArray;e.exports=t},6567:(e,t,r)=>{var n=r(8446),o=r(8092),a=r(8953),i=r(1485),u=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,s=l.toString,p=c.hasOwnProperty,f=RegExp("^"+s.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(n(e)?f:u).test(i(e))}},6701:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},6772:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},6805:(e,t,r)=>{var n=r(7310),o=r(3983)(n);e.exports=o},7129:(e,t,r)=>{var n=r(7148),o=r(3330),a=r(2934),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[n(e)]}},7148:(e,t,r)=>{var n=r(2781),o=r(7903),a=r(1738),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},7310:(e,t,r)=>{var n=r(3122),o=r(8559),a=r(4796),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;e.exports=i},7499:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},7781:e=>{"use strict";e.exports=o},7903:(e,t,r)=>{var n=r(2781),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,u=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,u),r=e[u];try{e[u]=void 0;var n=!0}catch(e){}var o=i.call(e);return n&&(t?e[u]=r:delete e[u]),o}},7995:(e,t,r)=>{var n=r(7129),o=r(41),a=r(3685),i=a&&a.isTypedArray,u=i?o(i):n;e.exports=u},8092:(e,t,r)=>{var n,o=r(8109),a=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},8109:(e,t,r)=>{var n=r(1433)["__core-js_shared__"];e.exports=n},8201:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},8330:(e,t,r)=>{var n=r(8446),o=r(3330);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},8446:(e,t,r)=>{var n=r(7148),o=r(8953);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},8531:e=>{"use strict";e.exports=a},8559:(e,t,r)=>{var n=r(9138),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},8953:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},9138:(e,t,r)=>{var n=r(6567),o=r(6772);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},9250:(e,t,r)=>{var n=r(7148),o=r(2934);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},9316:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}}},u={};function l(e){var t=u[e];if(void 0!==t)return t.exports;var r=u[e]={id:e,loaded:!1,exports:{}};return i[e](r,r.exports,l),r.loaded=!0,r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),l.p="public/plugins/bohat-smarterjaeger-datasource/";var c={};return(()=>{"use strict";l.r(c),l.d(c,{plugin:()=>S});var e=l(1308),t=l.n(e);l.p=t()&&t().uri?t().uri.slice(0,t().uri.lastIndexOf("/")+1):"public/plugins/bohat-smarterjaeger-datasource/";var r=l(7781),n=l(8531);const o={service:"",limit:100,operation:"ALL"};var a=l(1269),i=l(3936),u=l.n(i);function s(e,t,r,n,o,a,i){try{var u=e[a](i),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,u,"next",e)}function u(e){s(a,n,o,i,u,"throw",e)}i(void 0)}))}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){f(e,t,r[t])}))}return e}class y extends r.DataSourceApi{getDefaultQuery(e){return o}filterQuery(e){return!!e.service}splitTimeRange(e,t,r=10){if(t<=e)throw new Error("End time must be greater than start time");const n=t-e,o=Math.floor(n/r),a=[];for(let n=0;n<r;n++){const i=e+n*o,u=n<r-1?i+o:t;a.push({start:i,end:u})}return a}processTages(e){let t={};return void 0===!e&&e.forEach((e=>{let r=e.split("=");if(2===r.length){let e=r[0].trim(),n=r[1].trim();t[e]=n}})),t}filterUndifineFromMap(e){let t={};for(let r in e)void 0!==e[r]&&(t[r]=e[r]);return t}arrayToMap(e){let t={};return void 0===e||e.forEach((e=>{t[e]=null})),t}processQueryParams(e){let t={};if(e.service&&(t.service=e.service),e.operation&&"ALL"!==e.operation&&(t.operation=e.operation),e.maxDuration&&(t.maxDuration=e.maxDuration),e.minDuration&&(t.minDuration=e.minDuration),e.tags){t=v({},t,this.processTages(e.tags))}return e.limit&&(t.limit=e.limit),t}createCustomDataFrame(e,t,n={}){let o={},a=Object.keys(n),i=[],u=[],l=[],c=[],s=[];for(let e=0;e<a.length;e++){o[a[e]]=[]}for(let e=0;e<t.length;e++){let r=t[e];for(let e=0;e<r.length;e++){let t=r[e];i.push(t.traceID),u.push(t.spanID),l.push(t.duration),c.push(t.startTime),s.push(t.operationName);for(let e=0;e<a.length;e++){let r=a[e];o[r].push(t[r]?t[r]:null)}}}const p=[];p.push({name:"traceID",type:r.FieldType.string,values:i}),p.push({name:"spanID",type:r.FieldType.string,values:u}),p.push({name:"duration",type:r.FieldType.number,values:l}),p.push({name:"startTime",type:r.FieldType.time,values:c}),p.push({name:"operationName",type:r.FieldType.string,values:s});for(let e=0;e<a.length;e++){let t=a[e];p.push({name:t,type:r.FieldType.string,values:o[t]})}return(0,r.createDataFrame)({refId:e,fields:p})}randomSleep(){return p((function*(){return new Promise(((e,t)=>{setTimeout(e,100,"foo")}))}))()}query(e){var t=this;return p((function*(){const{range:r}=e,n=r.from.valueOf(),a=r.to.valueOf();let i=t.splitTimeRange(n,a,t.maxParallel);const l=function(){var e=p((function*(e,r,n,o={}){let a=JSON.parse(JSON.stringify(e));a.start=r,a.end=n;const i=new URLSearchParams(a).toString();let u=null;const l=[];let c=!1;for(let e=0;e<2;e++)if(u=yield t.request("/api/traces",i),200===u.status){c=!0;break}if(!1===c||null==u)return l;const s=e.service,p=e.operation,f=u.data.data;for(let e=0;e<f.length;e++){let t=f[e],r=t.processes,n=Object.keys(r),a=new Set;for(let e=0;e<n.length;e++)r[n[e]].serviceName===s&&a.add(n[e]);let i=t.spans;for(let e=0;e<i.length;e++){let r=i[e];if(!r.operationName===p||void 0===!p)continue;if(!a.has(r.processID))continue;let n=r.tags,u=v({},o);for(let e=0;e<n.length;e++){let t=n[e],r=t.key,a=void 0!==o[r],i=t.value;a&&(u[r]=i)}let c=v({},{traceID:t.traceID,spanID:r.spanID,operationName:r.operationName,startTime:r.startTime/1e3,duration:r.duration},u);l.push(c)}}return l}));return function(t,r,n){return e.apply(this,arguments)}}(),c={};for(let r=0;r<e.targets.length;r++){const n=e.targets[r],a=u()(n,o);let s=t.processQueryParams(a);s.lookback="custom";const p=t.arrayToMap(a.extractTags);let f=[];for(let e=0;e<i.length;e++){let t=i[e],r=1e3*t.start,n=1e3*t.end;f.push(l(s,r,n,p))}const v=yield Promise.all(f);c[n.refId]=t.createCustomDataFrame(n.refId,v,p)}return{data:e.targets.map((e=>c[e.refId]))}}))()}request(e,t){var r=this;return p((function*(){const o=(0,n.getBackendSrv)().fetch({url:`${r.baseUrl}${e}${(null==t?void 0:t.length)?`?${t}`:""}`});return(0,a.lastValueFrom)(o)}))()}testDatasource(){var e=this;return p((function*(){const t="Cannot connect to API";try{const r=yield e.request("/search");return 200===r.status?{status:"success",message:"Success"}:{status:"error",message:r.statusText?r.statusText:t}}catch(e){let r="";return"string"==typeof e?r=e:(0,n.isFetchError)(e)&&(r="Fetch error: "+(e.statusText?e.statusText:t),e.data&&e.data.error&&e.data.error.code&&(r+=": "+e.data.error.code+". "+e.data.error.message)),{status:"error",message:r}}}))()}constructor(e){var t;super(e),f(this,"baseUrl",void 0),f(this,"maxParallel",void 0),this.baseUrl=e.url,this.maxParallel=(null===(t=e.jsonData)||void 0===t?void 0:t.maxParallel)||10}}var b=l(5959),d=l.n(b),g=l(2007);function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){m(e,t,r[t])}))}return e}function j(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function x(e,t,r,n,o,a,i){try{var u=e[a](i),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function O(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){x(a,n,o,i,u,"next",e)}function u(e){x(a,n,o,i,u,"throw",e)}i(void 0)}))}}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){P(e,t,r[t])}))}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const S=new r.DataSourcePlugin(y).setConfigEditor((function(e){const{onOptionsChange:t,options:r}=e,{jsonData:n}=r;return d().createElement(d().Fragment,null,d().createElement(g.InlineField,{label:"Max Parallel",tooltip:"Max parallel requests"},d().createElement(g.Input,{type:"number",value:n.maxParallel||10,onChange:e=>{t(j(h({},r),{jsonData:j(h({},n),{maxParallel:parseInt(e.target.value,10)})}))},placeholder:"Max parallel requests",width:40})),d().createElement(g.DataSourceHttpSettings,{defaultUrl:"http://127.0.0.1:16686",dataSourceConfig:r,onChange:t}))})).setQueryEditor((function({query:e,onChange:t,onRunQuery:r}){const[o,a]=(0,b.useState)(e.service),[i,u]=(0,b.useState)(e.tags||[]),[l,c]=(0,b.useState)(!1),s=function(){var t=O((function*(){var t;const r=yield(0,n.getBackendSrv)().get("/api/datasources/proxy/uid/"+(null===(t=e.datasource)||void 0===t?void 0:t.uid)+"/api/services");let o=[];return null==r||r.data.map((e=>{let t={value:e};o.push(t)})),o}));return function(){return t.apply(this,arguments)}}(),p=function(){var t=O((function*(){var t;let r=[{value:"ALL"}];if(void 0===o)return r;const a=yield(0,n.getBackendSrv)().get("/api/datasources/proxy/uid/"+(null===(t=e.datasource)||void 0===t?void 0:t.uid)+"/api/services/"+o+"/operations");return null===a.data||null==a||a.data.map((e=>{let t={value:e};r.push(t)})),r}));return function(){return t.apply(this,arguments)}}();return d().createElement(d().Fragment,null,d().createElement(g.InlineField,{label:"Service"},d().createElement(g.Combobox,{options:s,onChange:n=>{t(D(w({},e),{service:(null==n?void 0:n.value)||""})),r(),a(null==n?void 0:n.value)},value:e.service,width:100})),d().createElement(g.InlineField,{label:"Operation"},d().createElement(g.Combobox,{options:p,onChange:n=>{t(D(w({},e),{operation:(null==n?void 0:n.value)||""})),r()},width:100,value:e.operation})),d().createElement(g.InlineField,{label:"Tags",invalid:l,error:l?"Invalid tag format":void 0,tooltip:'Values should be in the logfmt format. Example: "key=value"'},d().createElement(g.TagsInput,{id:"query-editor-tags",onChange:e=>{if(e.length>0){let t=e[e.length-1];if(!new RegExp("^[a-zA-Z0-9._-]+=[a-zA-Z0-9._-]+$").test(t))return e.pop(),void c(!0);c(!1)}u(e)},tags:i,width:100})),d().createElement(g.InlineField,{label:"Extract Tags"},d().createElement(g.TagsInput,{id:"query-editor-extract-tags",onChange:n=>{t(D(w({},e),{extractTags:n})),r()},tags:e.extractTags,width:100})),d().createElement(g.InlineField,{label:"Max Duration"},d().createElement("input",{type:"number",value:e.maxDuration,onChange:n=>{t(D(w({},e),{maxDuration:n.target.value})),r()}})),d().createElement(g.InlineField,{label:"Min Duration"},d().createElement("input",{type:"number",value:e.minDuration,onChange:n=>{t(D(w({},e),{minDuration:n.target.value})),r()}})),d().createElement(g.InlineField,{label:"Limit",tooltip:"Max number of results to return (maxParallel=10 and limit=10 mean total data points = 100)"},d().createElement("input",{type:"number",value:e.limit,onChange:n=>{t(D(w({},e),{limit:parseInt(n.target.value,10)})),r()}})))}))})(),c})()));
//# sourceMappingURL=module.js.map